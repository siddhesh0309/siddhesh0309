# ✅ Step 6: Check C – Base Key ID (before -1) → multiple addresses
df['KeyID_Base'] = df['Key ID'].astype(str).str.split('-').str[0]
basekey_to_addresses = df.groupby('KeyID_Base')['Normalized Address'].nunique().reset_index()
conflicting_basekeys = basekey_to_addresses[basekey_to_addresses['Normalized Address'] > 1]['KeyID_Base']
df['Conflict_Type_C'] = df['KeyID_Base'].isin(conflicting_basekeys)

# Step 7: Mark conflict reasons
df['Status'] = ''
df.loc[df['Conflict_Type_A'], 'Status'] += '❌ Address used by multiple Key IDs. '
df.loc[df['Conflict_Type_B'], 'Status'] += '❌ Key ID has multiple addresses. '
df.loc[df['Conflict_Type_C'], 'Status'] += '❌ Same base Key ID has multiple addresses. '
