import easyocr
import numpy as np
from PIL import Image
import io

reader = easyocr.Reader(['en'])  # Initialize EasyOCR

print("\n🔍 Extracting Text (Prefer Embedded, Use OCR if Needed)...\n")

ocr_text_output = ""

for i, page in enumerate(doc):
    print(f"\n📄 Processing Page {i+1}")

    # --- Embedded text using PyMuPDF ---
    embedded_text = page.get_text().strip()

    if embedded_text:
        print(f"✍️ Embedded Text Found:\n{embedded_text}")
        ocr_text = ""
        print("🛑 OCR skipped (embedded text is available)")
    else:
        print("⚠️ No embedded text found — using EasyOCR...")
        # Render page as image and apply EasyOCR
        pix = page.get_pixmap(dpi=300)
        img = Image.open(io.BytesIO(pix.tobytes("png")))

        result = reader.readtext(np.array(img), detail=0)
        ocr_text = "\n".join(result)
        print(f"🔎 OCR Text:\n{ocr_text}")

    # --- Combine texts ---
    ocr_text_output += f"\n--- Page {i+1} ---\n"
    ocr_text_output += f"\n[Embedded Text]\n{embedded_text}"
    ocr_text_output += f"\n[OCR Text]\n{ocr_text}"

doc.close()
